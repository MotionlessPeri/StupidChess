# DependencyPolicy

## 目标

控制第三方依赖数量与风险，保证 UE、Server、MiniApp/WASM 的长期可维护性。

## 默认原则

1. 默认不引入第三方库，优先标准库与自实现。
2. 只有当收益明确且有验证路径时才引入依赖。
3. 依赖决策必须先讨论并获得确认，再落库。

## 引入流程

1. 提案：说明要解决的问题、候选库、替代方案。
2. 评估：至少覆盖以下维度：
   - 价值：开发效率或稳定性收益。
   - 成本：学习、维护、升级、二进制体积。
   - 许可证：是否可商用、是否有传染性条款。
   - 跨平台：UE、Windows/Linux、MiniApp/WASM 兼容性。
   - 安全：历史漏洞、维护活跃度。
3. 决策：由项目负责人确认是否引入。
4. 落地：记录版本、接入方式、更新策略、回滚预案。

## 当前决策

1. 依赖管理器采用 `vcpkg`（manifest 模式）。
2. 测试框架采用 `gtest`，并通过 `vcpkg` 提供依赖。
3. `CTest` 作为统一测试入口，实际测试实现使用 `gtest`。
4. 构建参数统一通过 `CMakePresets.json` 管理，避免绕过 toolchain 约束。
5. `vcpkg.json` 必须固定 `builtin-baseline`，避免不同 vcpkg 实例解析到不一致的 ports 版本。
6. 测试依赖通过 manifest feature（`tests`）启用，避免无测试构建下载不必要依赖。

## 记录要求

1. 每个新增依赖都要在对应 ADR 或本文件补充记录。
2. 在 PR/提交说明中写明验证结果和兼容性结论。
3. 新成员依赖默认写入 `vcpkg.json`，禁止绕过包管理器直接散落接入。
